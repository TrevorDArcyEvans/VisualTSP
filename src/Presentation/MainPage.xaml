<Page
    x:Class="VisualTSP.Presentation.MainPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:presentation="clr-namespace:VisualTSP.Presentation"
    mc:Ignorable="d"
    xmlns:uen="using:Uno.Extensions.Navigation.UI"
    xmlns:utu="using:Uno.Toolkit.UI"
    xmlns:muxc="using:Microsoft.UI.Xaml.Controls">
    <Page.Resources>
        <MenuFlyout x:Key="AddNodeMenu" x:Name="AddNodeMenu">
            <MenuFlyoutItem Text="Add node" Click="AddNode" />
        </MenuFlyout>

        <MenuFlyout
            x:Key="EditNodeMenu"
            x:Name="EditNodeMenu"
            Opening="EditNodeMenu_OnOpening">
            <ToggleMenuFlyoutItem
                Text="Start"
                Click="StartNode"
                IsChecked="{x:Bind IsStart, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <ToggleMenuFlyoutItem
                Text="End"
                Click="EndNode"
                IsChecked="{x:Bind IsEnd, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
            <MenuFlyoutItem Text="Add link" Click="AddLink" />
            <MenuFlyoutItem Text="Edit" Click="EditNode" />
            <MenuFlyoutItem Text="Delete" Click="DeleteNode" />
        </MenuFlyout>

        <MenuFlyout x:Key="EditLinkMenu" x:Name="EditLinkMenu">
            <MenuFlyoutItem Text="Edit" Click="EditLink" />
            <MenuFlyoutItem Text="Delete" Click="DeleteLink" />
        </MenuFlyout>
    </Page.Resources>

    <Grid uen:Region.Attached="True">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*" />
            <ColumnDefinition Width="Auto" />
        </Grid.ColumnDefinitions>
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- visual surface -->
        <Grid Grid.RowSpan="2">
            <Grid.RowDefinitions>
                <RowDefinition Height="*" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>

            <!-- canvas -->
            <Border BorderBrush="Black" BorderThickness="1">
                <Canvas
                    x:Name="Surface"
                    Background="Transparent"
                    ContextFlyout="{StaticResource AddNodeMenu}"
                    PointerMoved="Canvas_OnPointerMoved"
                    PointerPressed="Canvas_OnPointerDown">

                    <Canvas.RenderTransform>
                        <CompositeTransform
                            ScaleX="1"
                            ScaleY="1" />
                    </Canvas.RenderTransform>

                    <!-- First child -->
                    <presentation:VisualNode
                        PointerEntered="Shape_OnMouseEntered"
                        PointerPressed="Shape_OnMouseDown"
                        PointerMoved="Shape_OnMouseMove"
                        PointerReleased="Shape_OnMouseUp"
                        PointerExited="Shape_OnMouseExited"
                        ContextFlyout="{StaticResource EditNodeMenu}" />

                    <!-- Second child -->
                    <presentation:VisualNode
                        PointerEntered="Shape_OnMouseEntered"
                        PointerPressed="Shape_OnMouseDown"
                        PointerMoved="Shape_OnMouseMove"
                        PointerReleased="Shape_OnMouseUp"
                        PointerExited="Shape_OnMouseExited"
                        ContextFlyout="{StaticResource EditNodeMenu}"
                        Canvas.Left="200"
                        Canvas.Top="200" />

                    <!-- Third child -->
                    <presentation:VisualNode
                        PointerEntered="Shape_OnMouseEntered"
                        PointerPressed="Shape_OnMouseDown"
                        PointerMoved="Shape_OnMouseMove"
                        PointerReleased="Shape_OnMouseUp"
                        PointerExited="Shape_OnMouseExited"
                        ContextFlyout="{StaticResource EditNodeMenu}"
                        Canvas.Left="400"
                        Canvas.Top="400" />

                    <!-- Fourth child -->
                    <presentation:VisualNode
                        PointerEntered="Shape_OnMouseEntered"
                        PointerPressed="Shape_OnMouseDown"
                        PointerMoved="Shape_OnMouseMove"
                        PointerReleased="Shape_OnMouseUp"
                        PointerExited="Shape_OnMouseExited"
                        ContextFlyout="{StaticResource EditNodeMenu}"
                        Canvas.Left="600"
                        Canvas.Top="400" />

                    <presentation:VisualLink
                        PointerEntered="Shape_OnMouseEntered"
                        PointerExited="Shape_OnMouseExited"
                        ContextFlyout="{StaticResource EditLinkMenu}"
                        X1="25"
                        Y1="25"
                        X2="225"
                        Y2="225"
                        Canvas.ZIndex="-1" />
                </Canvas>
            </Border>

            <!-- mouse pos -->
            <TextBlock
                Grid.Row="1"
                x:Name="MousePos" />
        </Grid>

        <Grid
            Grid.Row="0"
            Grid.Column="1"
            uen:Region.Attached="True"
            uen:Region.Navigator="Visibility">

            <!-- Visualisation -->
            <!-- view + file manipulation -->
            <StackPanel
                uen:Region.Name="Visualisation"
                Visibility="Collapsed">

                <!-- zoom -->
                <StackPanel
                    HorizontalAlignment="Center"
                    Margin="10">
                    <Button
                        Content="+"
                        ToolTipService.ToolTip="Zoom in"
                        Click="Zoom_In" />
                    <Button
                        Content="0"
                        ToolTipService.ToolTip="Reset"
                        Click="Zoom_Fit" />
                    <Button
                        Content="-"
                        ToolTipService.ToolTip="Zoom out"
                        Click="Zoom_Out" />
                </StackPanel>

                <!-- translate -->
                <Grid
                    Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition />
                        <ColumnDefinition />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition />
                        <RowDefinition />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <Button
                        Grid.Row="0"
                        Grid.Column="1"
                        Content="U"
                        ToolTipService.ToolTip="Translate up"
                        Click="Translate_Up" />
                    <Button
                        Grid.Row="1"
                        Grid.Column="0"
                        Content="L"
                        ToolTipService.ToolTip="Translate left"
                        Click="Translate_Left" />
                    <Button
                        Grid.Row="1"
                        Grid.Column="2"
                        Content="R"
                        ToolTipService.ToolTip="Translate right"
                        Click="Translate_Right" />
                    <Button
                        Grid.Row="2"
                        Grid.Column="1"
                        Content="D"
                        ToolTipService.ToolTip="Translate down"
                        Click="Translate_Down" />
                    <Button
                        Grid.Row="1"
                        Grid.Column="1"
                        Content="O"
                        ToolTipService.ToolTip="Reset"
                        Click="Translate_Reset" />
                </Grid>

                <utu:Divider />

                <!-- file operations -->
                <StackPanel
                    HorizontalAlignment="Center">
                    <Button
                        Content="Open..."
                        Margin="10"
                        Click="OnOpen" />
                    <Button
                        Content="Save..."
                        Margin="10"
                        Click="OnSave" />
                </StackPanel>
            </StackPanel>

            <!-- Calculation -->
            <ScrollViewer
                uen:Region.Name="Calculation"
                Visibility="Collapsed"
                HorizontalScrollBarVisibility="Auto"
                VerticalScrollBarVisibility="Auto">
                <StackPanel
                    HorizontalAlignment="Center">

                    <!-- control -->
                    <StackPanel>
                        <Button
                            Content="Restart"
                            Margin="10"
                            Click="OnRestart" />
                        <Button
                            Content="Next Step"
                            Margin="10"
                            Click="OnNextStep" />
                        <Button
                            Content="Play / Pause"
                            Margin="10"
                            Click="OnPlayPause" />
                    </StackPanel>

                    <utu:Divider />

                    <!-- simulated annealing -->
                    <StackPanel Margin="10">
                        <TextBlock Text="Sim. Annealing" FontWeight="ExtraBlack" FontSize="18" />
                        <TextBlock>
                            <Run Text="Temp:  " />
                            <Run Text="{x:Bind Temperature}" />
                        </TextBlock>
                        <TextBlock>
                            <Run Text="Dist:  " />
                            <Run Text="{x:Bind Distance}" />
                        </TextBlock>
                        <CheckBox Content="Reheat" />
                        <CheckBox Content="Use greedy route as start" />
                        <CheckBox Content="Show" />
                    </StackPanel>

                    <utu:Divider />

                    <!-- greedy solver -->
                    <StackPanel Margin="10">
                        <TextBlock Text="Greedy Solver" FontWeight="ExtraBlack" FontSize="18" />
                        <TextBlock>
                            <Run Text="Dist:  " />
                            <Run Text="{x:Bind Distance}" />
                        </TextBlock>
                        <CheckBox Content="Show" />
                    </StackPanel>

                    <utu:Divider />

                    <!-- original -->
                    <StackPanel Margin="10">
                        <TextBlock Text="Original" FontWeight="ExtraBlack" FontSize="18" />
                        <TextBlock>
                            <Run Text="Dist:  " />
                            <Run Text="{x:Bind Distance}" />
                        </TextBlock>
                        <CheckBox Content="Show" />
                    </StackPanel>

                    <utu:Divider />

                    <!-- advanced -->
                    <StackPanel Margin="10">
                        <TextBlock Text="Advanced" FontWeight="ExtraBlack" FontSize="18" />
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Initial temp.:  " />
                            <muxc:NumberBox
                                Value="{x:Bind InitialTemperature, Mode=TwoWay}"
                                SmallChange="1"
                                LargeChange="10"
                                Minimum="0"
                                Maximum="200"
                                SpinButtonPlacementMode="Inline" />
                        </StackPanel>
                        <TextBlock Text="Decay speed" />
                        <Slider
                            Value="{x:Bind RawDecaySpeed, Mode=TwoWay}"
                            Minimum="-1500"
                            Maximum="1500"
                            IsThumbToolTipEnabled="False"
                            Orientation="Horizontal" />

                        <utu:Divider />

                        <TextBlock Text="Reheat Settings" FontWeight="ExtraBlack" />
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Reheat temp.:  " />
                            <muxc:NumberBox
                                Value="0.005"
                                SmallChange="0.001"
                                LargeChange="10"
                                Minimum="0"
                                Maximum="1"
                                SpinButtonPlacementMode="Inline" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Min. amount.:  " />
                            <muxc:NumberBox
                                Value="100"
                                SmallChange="1"
                                LargeChange="10"
                                Minimum="0"
                                Maximum="200"
                                SpinButtonPlacementMode="Inline" />
                        </StackPanel>
                        <StackPanel Orientation="Horizontal">
                            <TextBlock Text="Max. amount:  " />
                            <muxc:NumberBox
                                Value="100"
                                SmallChange="1"
                                LargeChange="10"
                                Minimum="0"
                                Maximum="200"
                                SpinButtonPlacementMode="Inline" />
                        </StackPanel>

                        <utu:Divider />

                        <Button
                            Content="Reset settings"
                            Margin="10"
                            HorizontalAlignment="Center" />

                        <utu:Divider />

                        <TextBlock Text="Information" FontWeight="ExtraBlack" />
                        <TextBlock>
                            <Run Text="Decay:  " />
                            <Run Text="{x:Bind DecaySpeed, Mode=TwoWay}" />
                        </TextBlock>
                        <TextBlock>
                            <Run Text="Iteration #:  " />
                            <Run Text="{x:Bind InitialTemperature, Mode=TwoWay}" />
                        </TextBlock>
                    </StackPanel>

                </StackPanel>
            </ScrollViewer>
        </Grid>

        <utu:TabBar
            Grid.Row="1"
            Grid.Column="1"
            uen:Region.Attached="True"
            VerticalAlignment="Bottom">
            <utu:TabBar.Items>
                <utu:TabBarItem uen:Region.Name="Visualisation" Content="Visualisation" IsSelected="True" />
                <utu:TabBarItem uen:Region.Name="Calculation" Content="Calculation" />
            </utu:TabBar.Items>
        </utu:TabBar>
    </Grid>

</Page>
